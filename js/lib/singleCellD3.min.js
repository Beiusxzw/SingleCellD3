!function(global,factory){"object"==typeof exports&&"undefined"!=typeof module?factory(exports):"function"==typeof define&&define.amd?define(["exports"],factory):factory((global="undefined"!=typeof globalThis?globalThis:global||self).scd3=global.scd3||{})}(this,(function(exports){"use strict";var version="1.0.0";function createTooltip(target){var tooltip;return d3.select(target).append("div").attr("class","d3tooltip")}function createTsneSvg(target,data,style,color_scale,color_by=2,stroke_width=4,onclick=(d=>d),onleave=(d=>d)){var svg,g=d3.select(target).append("svg").attr("viewBox",[0,0,1.2*style.width,style.height+style.margin.top+style.margin.bottom]).attr("width",.8*style.width+style.margin.left+style.margin.right).attr("height",style.height+style.margin.top+style.margin.bottom).append("g").attr("transform","translate("+style.margin.left+","+style.margin.top+")").append("g").attr("fill","none").attr("stroke-linecap","round"),tsne_x=data.map(d=>parseFloat(d[0])),tsne_y=data.map(d=>parseFloat(d[1])),tsne_x_max=0,tsne_y_max=0;color_scale||(color_scale=d3.scaleOrdinal().domain(data.map(d=>d[2])).range(d3.schemeCategory10)),tsne_x.map((function(d,i){Math.abs(d)>tsne_x_max&&(tsne_x_max=Math.abs(d))})),tsne_y.map((function(d,i){Math.abs(d)>tsne_y_max&&(tsne_y_max=Math.abs(d))}));var x=d3.scaleLinear().domain([1.2*-tsne_x_max,1.2*tsne_x_max]).range([0,style.width]),y=d3.scaleLinear().domain([1.2*-tsne_y_max,1.2*tsne_y_max]).range([style.height,0]);return g.selectAll("path").data(data).join("path").style("cursor","pointer").attr("class","tsne-circle").attr("d",d=>`M${x(parseFloat(d[0]))},${y(parseFloat(d[1]))}h0`).attr("stroke",d=>color_scale(d[color_by])).attr("stroke-width",(function(d){return stroke_width})),g.selectAll("path").on("click",(function(d,i){d3.select(this).transition().duration("100").attr("stroke-width",2*stroke_width),onclick(d)})).on("mouseout",(function(d,i){d3.select(this).transition().duration("20").attr("stroke-width",stroke_width),onleave(d)})),g}function createViolin(target,data,style,color_scale,color_by=2,onclick=(d=>d),onleave=(d=>d)){var box=d3.select(target).append("svg").attr("class","graph-svg-component").attr("width",style.width+style.margin.left+style.margin.right).attr("height",1*(style.height+style.margin.top+style.margin.bottom)).style("text-align","center").style("margin","0 auto").style("margin-top","5rem").append("g").attr("transform","translate("+style.margin.left+","+style.margin.top+")");function kernelDensityEstimator(kernel,X){return function(V){return X.map((function(x){return[x,d3.mean(V,(function(v){return kernel(x-v)}))]}))}}function kernelEpanechnikov(k){return function(v){return Math.abs(v/=k)<=1?.75*(1-v*v)/k:0}}var box_x=d3.scaleBand().range([0,style.width]).domain(data.map(d=>d[2])).padding(1),x=d3.scaleLinear().domain(data.map(d=>d[2])).range([0,style.width]),box_y=d3.scaleLinear().domain([0,5]).range([0,.5*(style.height+style.margin.top+style.margin.bottom)]);box.append("g").call(d3.axisLeft(box_y).ticks(5)).style("font-size","12pt"),box.append("g").attr("transform","translate(0,"+.5*(style.height+style.margin.top+style.margin.bottom)+")").call(d3.axisBottom(box_x)).selectAll("text").attr("y",0).attr("x",9).attr("dy",".35em").attr("transform","rotate(90)").style("text-anchor","start").style("font-size","10pt");var kde=kernelDensityEstimator(kernelEpanechnikov(7),x.ticks(50)),max_num=0,hist=Array();Array.from(d3.rollup(data,v=>Array.from(v,d=>parseFloat(d[d.length-1])),d=>d[2]).entries()).map((function(d){var bin,bin_value=d3.bin()(d[1]);bin_value.cluster_id=d[0],hist.push({key:d[0],value:bin_value})}));var xNum=d3.scaleLinear().range([-20,20]).domain([-20,20]),violin_max=0;Object.values(hist).map(d=>d.value.map(x=>x.length)).flat().map(d=>{d>violin_max&&(violin_max=d)});var violin_scale=20/violin_max;color_scale||(color_scale=d3.scaleOrdinal().domain(data.map(d=>d[2])).range(d3.schemeCategory10)),box.append("g").attr("transform","translate(0,"+.5*(style.height+style.margin.top+style.margin.bottom)+")").call(d3.axisBottom(box_x)).selectAll("text").attr("y",0).attr("x",9).attr("dy",".35em").attr("transform","rotate(90)").style("text-anchor","start").style("font-size","10pt");var jitterWidth=5;return box.selectAll("indPoints").data(data).enter().append("circle").style("cursor","pointer").attr("cx",(function(d){return box_x(d[2])-2.5+5*Math.random()})).attr("cy",(function(d){return box_y(parseFloat(d[d.length-1]))})).attr("r",1).style("stroke","black").style("stroke-width","0.5").style("fill",color_scale(d=>d[2])).style("fill","#7F7F7F"),box.selectAll("violin").data(hist).enter().append("g").attr("transform",(function(d){return"translate("+box_x(d.key)+" ,0)"})).append("path").style("cursor","pointer").datum((function(d){return d.value})).attr("class","violin-path").style("stroke","black").style("stroke-width","0.5").style("fill",(function(d){return color_scale(d.cluster_id)})).style("opacity","0.5").attr("d",d3.area().x0((function(d){return xNum(-d.length*violin_scale)})).x1((function(d){return xNum(d.length*violin_scale)})).y((function(d){return box_y(d.x0)})).curve(d3.curveCatmullRom)),box}exports.createTooltip=createTooltip,exports.createTsneSvg=createTsneSvg,exports.createViolin=createViolin,Object.defineProperty(exports,"__esModule",{value:!0})}));